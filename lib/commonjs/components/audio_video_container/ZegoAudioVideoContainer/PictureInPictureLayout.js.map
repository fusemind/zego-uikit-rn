{"version":3,"names":["PictureInPictureLayout","props","config","foregroundBuilder","audioVideoConfig","sortAudioVideo","isSmallViewDraggable","smallViewBackgroundColor","largeViewBackgroundColor","smallViewBackgroundImage","largeViewBackgroundImage","smallViewPostion","ZegoViewPostion","bottomRight","switchLargeOrSmallViewByClick","smallViewSize","width","height","spacingBetweenSmallViews","removeViewWhenAudioVideoUnavailable","useVideoViewAspectFill","showSoundWavesInAudioMode","realTimeData","useRef","globalAudioVideoUserList","setGlobalAudioVideoUserList","useState","panResponder","PanResponder","create","onStartShouldSetPanResponderCapture","console","log","current","useEffect","callbackID","String","Math","floor","random","ZegoUIKitInternal","onAudioVideoAvailable","userList","forEach","user","result","find","item","userID","push","arr","onAudioVideoUnavailable","findIndex","splice","onAudioVideoListForceSort","onUserLeave","getSmallViewPostStyle","styleList","styles","smallViewPostTopLeft","smallViewPostTopRight","smallViewPostBottomLeft","smallViewPostBottomRight","topLeft","switchLargeOrSmallView","index","layoutHandle","event","nativeEvent","layout","x","y","container","smallViewContainer","slice","map","panHandlers","bind","smallView","smallViewBorder","getSmallViewSize","getSmallViewSpacing","smallViewSpacing","bigView","StyleSheet","margin","marginBottom","flex","position","backgroundColor","zIndex","borderRadius","overflow","borderWidth","borderColor","top","left","right","bottom","justifyContent"],"sources":["PictureInPictureLayout.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport ZegoUIKitInternal from \"../../internal/ZegoUIKitInternal\";\nimport ZegoAudioVideoView from \"../../audio_video/ZegoAudioVideoView\";\nimport { StyleSheet, View, PanResponder, TouchableWithoutFeedback } from 'react-native'\nimport { ZegoViewPostion } from './defines'\n\nexport default function PictureInPictureLayout(props) {\n    const { config = {}, foregroundBuilder, audioVideoConfig = {}, sortAudioVideo } = props;\n    const {\n        isSmallViewDraggable = false, // TODO\n        smallViewBackgroundColor = '',\n        largeViewBackgroundColor = '',\n        smallViewBackgroundImage = '',\n        largeViewBackgroundImage = '',\n        smallViewPostion = ZegoViewPostion.bottomRight,\n        switchLargeOrSmallViewByClick = true,\n        smallViewSize = { width: 85, height: 151 },\n        spacingBetweenSmallViews = 8,\n        removeViewWhenAudioVideoUnavailable = false,\n    } = config;\n    const {\n        useVideoViewAspectFill = false,\n        showSoundWavesInAudioMode = true,\n    } = audioVideoConfig;\n    const realTimeData = useRef();\n    const [globalAudioVideoUserList, setGlobalAudioVideoUserList] = useState([]);\n    const panResponder = useRef(PanResponder.create({\n        onStartShouldSetPanResponderCapture: () => {\n            console.log('Switch the big screen');\n        }\n    })).current;\n\n    useEffect(() => {\n        realTimeData.current = [];\n        const callbackID = 'PictureInPictureLayout' + String(Math.floor(Math.random() * 10000));\n        ZegoUIKitInternal.onAudioVideoAvailable(callbackID, (userList) => {\n            userList.forEach((user) => {\n                const result = realTimeData.current.find((item) => user.userID === item.userID);\n                if (!result) {\n                    realTimeData.current.push(user);\n                    setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                }\n            });\n        });\n        ZegoUIKitInternal.onAudioVideoUnavailable(callbackID, (userList) => {\n            if (removeViewWhenAudioVideoUnavailable) {\n                userList.forEach((user) => {\n                    const result = realTimeData.current.findIndex((item) => user.userID === item.userID);\n                    if (result !== -1) {\n                        realTimeData.current.splice(result, 1);\n                        setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                    }\n                });\n            }\n        });\n        ZegoUIKitInternal.onAudioVideoListForceSort(callbackID, () => {\n            setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n        });\n        ZegoUIKitInternal.onUserLeave(callbackID, (userList) => {\n            if (!removeViewWhenAudioVideoUnavailable) {\n                userList.forEach((user) => {\n                    const result = realTimeData.current.findIndex((item) => user.userID === item.userID);\n                    if (result !== -1) {\n                        realTimeData.current.splice(result, 1);\n                        setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                    }\n                });\n            }\n        });\n        return () => {\n            ZegoUIKitInternal.onAudioVideoListForceSort(callbackID);\n            ZegoUIKitInternal.onAudioVideoAvailable(callbackID);\n            ZegoUIKitInternal.onAudioVideoUnavailable(callbackID);\n            ZegoUIKitInternal.onUserLeave(callbackID);\n        }\n    }, [])\n    const getSmallViewPostStyle = () => {\n        const styleList = [styles.smallViewPostTopLeft, styles.smallViewPostTopRight, styles.smallViewPostBottomLeft, styles.smallViewPostBottomRight];\n        if (smallViewPostion >= ZegoViewPostion.topLeft && smallViewPostion <= ZegoViewPostion.bottomRight) {\n            return styleList[smallViewPostion];\n        } else {\n            return styles.smallViewPostTopLeft;\n        }\n    }\n    const switchLargeOrSmallView = (index, user) => {\n        if (switchLargeOrSmallViewByClick) {\n            globalAudioVideoUserList[0] = globalAudioVideoUserList.splice(index + 1, 1, globalAudioVideoUserList[0])[0];\n            setGlobalAudioVideoUserList((arr) => [...globalAudioVideoUserList]);\n            realTimeData.current = globalAudioVideoUserList;\n        }\n    }\n    const layoutHandle = (event) => {\n        const { nativeEvent } = event;\n        const { layout } = nativeEvent;\n        const { width, height, x, y } = layout;\n        console.log('######layoutHandle', layout);\n    }\n\n    return (<View style={styles.container}>\n        <View style={[styles.smallViewContainer, getSmallViewPostStyle()]} onLayout={layoutHandle}>\n            {\n                globalAudioVideoUserList.slice(1, 4).map((user, index) => <TouchableWithoutFeedback {...panResponder.panHandlers} onPress={switchLargeOrSmallView.bind(this, index, user)}><View\n                    key={user.userID}\n                    style={[\n                        styles.smallView,\n                        styles.smallViewBorder,\n                        getSmallViewSize(smallViewSize.width, smallViewSize.height).smallViewSize,\n                        getSmallViewSpacing(spacingBetweenSmallViews).smallViewSpacing,\n                    ]}>\n                        <ZegoAudioVideoView\n                            key={user.userID}\n                            userID={user.userID}\n                            audioViewBackgroudColor={smallViewBackgroundColor}\n                            audioViewBackgroudImage={smallViewBackgroundImage}\n                            showSoundWave={showSoundWavesInAudioMode}\n                            useVideoViewAspectFill={useVideoViewAspectFill}\n                            foregroundBuilder={foregroundBuilder}\n                        />\n                </View></TouchableWithoutFeedback>)\n            }\n        </View>\n        <View style={styles.bigView}>\n            {globalAudioVideoUserList[0] ?\n                <ZegoAudioVideoView\n                    key={globalAudioVideoUserList[0].userID}\n                    userID={globalAudioVideoUserList[0].userID}\n                    audioViewBackgroudColor={largeViewBackgroundColor}\n                    audioViewBackgroudImage={largeViewBackgroundImage}\n                    showSoundWave={showSoundWavesInAudioMode}\n                    useVideoViewAspectFill={useVideoViewAspectFill}\n                    foregroundBuilder={foregroundBuilder}\n                /> :\n                <View />\n            }\n        </View>\n    </View>)\n}\n\nconst getSmallViewSize = (width, height) => StyleSheet.create({\n    smallViewSize: {\n        width,\n        height,\n    },\n});\nconst getSmallViewSpacing = (margin) => StyleSheet.create({\n    smallViewSpacing: {\n        marginBottom: margin,\n    },\n});\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n    },\n    bigView: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n        backgroundColor: '#4A4B4D',\n        zIndex: 1,\n    },\n    smallViewContainer: {\n        flex: 1,\n        position: 'absolute',\n        zIndex: 12,\n        // height: '76%',\n    },\n    smallView: {\n        borderRadius: 10,\n        overflow: 'hidden',\n        backgroundColor: '#4A4B4D',\n    },\n    smallViewBorder: {\n        borderWidth: 0.5,\n        borderColor: '#A4A4A4',\n    },\n    smallViewPostTopLeft: {\n        top: 80,\n        left: 12,\n    },\n    smallViewPostTopRight: {\n        top: 80,\n        right: 12,\n    },\n    smallViewPostBottomLeft: {\n        bottom: 100,\n        left: 12,\n        justifyContent: 'flex-end'\n    },\n    smallViewPostBottomRight: {\n        bottom: 100,\n        right: 12,\n        justifyContent: 'flex-end'\n    }\n})"],"mappings":"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"}