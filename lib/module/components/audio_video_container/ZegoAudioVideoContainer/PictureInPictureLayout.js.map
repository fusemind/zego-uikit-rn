{"version":3,"names":["React","useEffect","useState","useRef","ZegoUIKitInternal","ZegoAudioVideoView","StyleSheet","View","PanResponder","TouchableWithoutFeedback","ZegoViewPostion","PictureInPictureLayout","props","config","foregroundBuilder","audioVideoConfig","sortAudioVideo","isSmallViewDraggable","smallViewBackgroundColor","largeViewBackgroundColor","smallViewBackgroundImage","largeViewBackgroundImage","smallViewPostion","bottomRight","switchLargeOrSmallViewByClick","smallViewSize","width","height","spacingBetweenSmallViews","removeViewWhenAudioVideoUnavailable","useVideoViewAspectFill","showSoundWavesInAudioMode","realTimeData","globalAudioVideoUserList","setGlobalAudioVideoUserList","panResponder","create","onStartShouldSetPanResponderCapture","console","log","current","callbackID","String","Math","floor","random","onAudioVideoAvailable","userList","forEach","user","result","find","item","userID","push","arr","onAudioVideoUnavailable","findIndex","splice","onAudioVideoListForceSort","onUserLeave","getSmallViewPostStyle","styleList","styles","smallViewPostTopLeft","smallViewPostTopRight","smallViewPostBottomLeft","smallViewPostBottomRight","topLeft","switchLargeOrSmallView","index","layoutHandle","event","nativeEvent","layout","x","y","container","smallViewContainer","slice","map","panHandlers","bind","smallView","smallViewBorder","getSmallViewSize","getSmallViewSpacing","smallViewSpacing","bigView","margin","marginBottom","flex","position","backgroundColor","zIndex","borderRadius","overflow","borderWidth","borderColor","top","left","right","bottom","justifyContent"],"sources":["PictureInPictureLayout.js"],"sourcesContent":["import React, { useEffect, useState, useRef } from \"react\";\nimport ZegoUIKitInternal from \"../../internal/ZegoUIKitInternal\";\nimport ZegoAudioVideoView from \"../../audio_video/ZegoAudioVideoView\";\nimport { StyleSheet, View, PanResponder, TouchableWithoutFeedback } from 'react-native'\nimport { ZegoViewPostion } from './defines'\n\nexport default function PictureInPictureLayout(props) {\n    const { config = {}, foregroundBuilder, audioVideoConfig = {}, sortAudioVideo } = props;\n    const {\n        isSmallViewDraggable = false, // TODO\n        smallViewBackgroundColor = '',\n        largeViewBackgroundColor = '',\n        smallViewBackgroundImage = '',\n        largeViewBackgroundImage = '',\n        smallViewPostion = ZegoViewPostion.bottomRight,\n        switchLargeOrSmallViewByClick = true,\n        smallViewSize = { width: 85, height: 151 },\n        spacingBetweenSmallViews = 8,\n        removeViewWhenAudioVideoUnavailable = false,\n    } = config;\n    const {\n        useVideoViewAspectFill = false,\n        showSoundWavesInAudioMode = true,\n    } = audioVideoConfig;\n    const realTimeData = useRef();\n    const [globalAudioVideoUserList, setGlobalAudioVideoUserList] = useState([]);\n    const panResponder = useRef(PanResponder.create({\n        onStartShouldSetPanResponderCapture: () => {\n            console.log('Switch the big screen');\n        }\n    })).current;\n\n    useEffect(() => {\n        realTimeData.current = [];\n        const callbackID = 'PictureInPictureLayout' + String(Math.floor(Math.random() * 10000));\n        ZegoUIKitInternal.onAudioVideoAvailable(callbackID, (userList) => {\n            userList.forEach((user) => {\n                const result = realTimeData.current.find((item) => user.userID === item.userID);\n                if (!result) {\n                    realTimeData.current.push(user);\n                    setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                }\n            });\n        });\n        ZegoUIKitInternal.onAudioVideoUnavailable(callbackID, (userList) => {\n            if (removeViewWhenAudioVideoUnavailable) {\n                userList.forEach((user) => {\n                    const result = realTimeData.current.findIndex((item) => user.userID === item.userID);\n                    if (result !== -1) {\n                        realTimeData.current.splice(result, 1);\n                        setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                    }\n                });\n            }\n        });\n        ZegoUIKitInternal.onAudioVideoListForceSort(callbackID, () => {\n            setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n        });\n        ZegoUIKitInternal.onUserLeave(callbackID, (userList) => {\n            if (!removeViewWhenAudioVideoUnavailable) {\n                userList.forEach((user) => {\n                    const result = realTimeData.current.findIndex((item) => user.userID === item.userID);\n                    if (result !== -1) {\n                        realTimeData.current.splice(result, 1);\n                        setGlobalAudioVideoUserList((arr) => [...(sortAudioVideo ? sortAudioVideo(realTimeData.current) : realTimeData.current)]);\n                    }\n                });\n            }\n        });\n        return () => {\n            ZegoUIKitInternal.onAudioVideoListForceSort(callbackID);\n            ZegoUIKitInternal.onAudioVideoAvailable(callbackID);\n            ZegoUIKitInternal.onAudioVideoUnavailable(callbackID);\n            ZegoUIKitInternal.onUserLeave(callbackID);\n        }\n    }, [])\n    const getSmallViewPostStyle = () => {\n        const styleList = [styles.smallViewPostTopLeft, styles.smallViewPostTopRight, styles.smallViewPostBottomLeft, styles.smallViewPostBottomRight];\n        if (smallViewPostion >= ZegoViewPostion.topLeft && smallViewPostion <= ZegoViewPostion.bottomRight) {\n            return styleList[smallViewPostion];\n        } else {\n            return styles.smallViewPostTopLeft;\n        }\n    }\n    const switchLargeOrSmallView = (index, user) => {\n        if (switchLargeOrSmallViewByClick) {\n            globalAudioVideoUserList[0] = globalAudioVideoUserList.splice(index + 1, 1, globalAudioVideoUserList[0])[0];\n            setGlobalAudioVideoUserList((arr) => [...globalAudioVideoUserList]);\n            realTimeData.current = globalAudioVideoUserList;\n        }\n    }\n    const layoutHandle = (event) => {\n        const { nativeEvent } = event;\n        const { layout } = nativeEvent;\n        const { width, height, x, y } = layout;\n        console.log('######layoutHandle', layout);\n    }\n\n    return (<View style={styles.container}>\n        <View style={[styles.smallViewContainer, getSmallViewPostStyle()]} onLayout={layoutHandle}>\n            {\n                globalAudioVideoUserList.slice(1, 4).map((user, index) => <TouchableWithoutFeedback {...panResponder.panHandlers} onPress={switchLargeOrSmallView.bind(this, index, user)}><View\n                    key={user.userID}\n                    style={[\n                        styles.smallView,\n                        styles.smallViewBorder,\n                        getSmallViewSize(smallViewSize.width, smallViewSize.height).smallViewSize,\n                        getSmallViewSpacing(spacingBetweenSmallViews).smallViewSpacing,\n                    ]}>\n                        <ZegoAudioVideoView\n                            key={user.userID}\n                            userID={user.userID}\n                            audioViewBackgroudColor={smallViewBackgroundColor}\n                            audioViewBackgroudImage={smallViewBackgroundImage}\n                            showSoundWave={showSoundWavesInAudioMode}\n                            useVideoViewAspectFill={useVideoViewAspectFill}\n                            foregroundBuilder={foregroundBuilder}\n                        />\n                </View></TouchableWithoutFeedback>)\n            }\n        </View>\n        <View style={styles.bigView}>\n            {globalAudioVideoUserList[0] ?\n                <ZegoAudioVideoView\n                    key={globalAudioVideoUserList[0].userID}\n                    userID={globalAudioVideoUserList[0].userID}\n                    audioViewBackgroudColor={largeViewBackgroundColor}\n                    audioViewBackgroudImage={largeViewBackgroundImage}\n                    showSoundWave={showSoundWavesInAudioMode}\n                    useVideoViewAspectFill={useVideoViewAspectFill}\n                    foregroundBuilder={foregroundBuilder}\n                /> :\n                <View />\n            }\n        </View>\n    </View>)\n}\n\nconst getSmallViewSize = (width, height) => StyleSheet.create({\n    smallViewSize: {\n        width,\n        height,\n    },\n});\nconst getSmallViewSpacing = (margin) => StyleSheet.create({\n    smallViewSpacing: {\n        marginBottom: margin,\n    },\n});\nconst styles = StyleSheet.create({\n    container: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n    },\n    bigView: {\n        flex: 1,\n        width: '100%',\n        height: '100%',\n        position: 'absolute',\n        backgroundColor: '#4A4B4D',\n        zIndex: 1,\n    },\n    smallViewContainer: {\n        flex: 1,\n        position: 'absolute',\n        zIndex: 12,\n        // height: '76%',\n    },\n    smallView: {\n        borderRadius: 10,\n        overflow: 'hidden',\n        backgroundColor: '#4A4B4D',\n    },\n    smallViewBorder: {\n        borderWidth: 0.5,\n        borderColor: '#A4A4A4',\n    },\n    smallViewPostTopLeft: {\n        top: 80,\n        left: 12,\n    },\n    smallViewPostTopRight: {\n        top: 80,\n        right: 12,\n    },\n    smallViewPostBottomLeft: {\n        bottom: 100,\n        left: 12,\n        justifyContent: 'flex-end'\n    },\n    smallViewPostBottomRight: {\n        bottom: 100,\n        right: 12,\n        justifyContent: 'flex-end'\n    }\n})"],"mappings":"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"}